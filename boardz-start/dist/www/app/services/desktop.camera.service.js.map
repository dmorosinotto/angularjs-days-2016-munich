{"version":3,"sources":["services/desktop.camera.service.ts"],"names":[],"mappings":"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","file":"services/desktop.camera.service.js","sourcesContent":["import {Observable} from 'rxjs/Observable';\nimport {ICameraService} from './camera.service.ts';\n\n// Just to stop annoying TSC...\ndeclare var window;\n\nexport class DesktopCameraService implements ICameraService {\n    private getMediaDevices(): any {\n        const mediaDevices = ((window.navigator.mozGetUserMedia || window.navigator.webkitGetUserMedia) ? {\n                getUserMedia: function (options) {\n                    return new Promise((resolve, reject) => {\n                        (window.navigator.mozGetUserMedia ||\n                        window.navigator.webkitGetUserMedia).call(window.navigator, options, resolve, reject);\n                    });\n                }\n            } : null) || window.navigator.mediaDevices;\n\n        return mediaDevices;\n    }\n\n    public getPhoto(): Observable<string> {\n        return Observable.fromPromise(\n            this.getMediaDevices().getUserMedia({ video: true, audio: false })\n                .then((stream: any) => {\n                        return new Promise((resolve, reject) => {\n                            try {\n                                var vendorURL = window.URL || window.webkitURL;\n                                var doc = document;\n                                var videoElement = doc.createElement('video');\n                                videoElement.src = vendorURL.createObjectURL(stream);\n                                videoElement.play();\n\n                                videoElement.addEventListener('canplay', () => {\n                                    var canvasElement = doc.createElement('canvas');\n                                    canvasElement.setAttribute('width', videoElement.videoWidth.toString());\n                                    canvasElement.setAttribute('height', videoElement.videoHeight.toString());\n\n                                    // Wait a bit before taking a screenshot so the camera has time to adjust lights\n                                    setTimeout(() => {\n                                        var context = canvasElement.getContext('2d');\n                                        context.drawImage(videoElement, 0, 0, videoElement.videoWidth, videoElement.videoHeight);\n\n                                        var url = canvasElement.toDataURL('image/png');\n\n                                        videoElement.pause();\n\n                                        if (stream.stop) {\n                                            stream.stop();\n                                        }\n\n                                        if (stream.getAudioTracks) {\n                                            stream.getAudioTracks().forEach((track: any) => {\n                                                track.stop();\n                                            });\n                                        }\n\n                                        if (stream.getVideoTracks) {\n                                            stream.getVideoTracks().forEach((track: any) => {\n                                                track.stop();\n                                            });\n                                        }\n\n                                        resolve(url);\n                                    }, 500);\n                                });\n                            }\n                            catch (e) {\n                                reject(e);\n                            }\n                        });\n\n                    }\n                ));\n    }\n}\n"],"sourceRoot":"/source/"}